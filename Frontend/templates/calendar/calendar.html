{% extends 'base/base_dashboard.html' %}

{% block title %}艾力克電機{% endblock %}

{% block import %}

{% load static%}
<link rel="stylesheet" href="{% static 'css/calendar/calendar.css' %}">
{% endblock %}

{% load custom_tags %}


{% block main %}
<div class="main">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-8">
                <div id='calendar'></div>
            </div>
            <div class="col-12 col-md-4 border p-4 p-md-2">
                <h5 class="font-weight-bold">點擊行程 顯示詳細內容</h5>
                <div id="calendar-title"></div>
                <div id="calendar-date"></div>
                <div id="calendar-location"></div>
          </div>
        </div>
    </div>
</div>

<script src="{% static 'js/fullcalendar/index.global.min.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale:'zh-tw',
            events: function(fetchInfo, successCallback, failureCallback) {
                $.ajax({
                    url: '/restful/calendar',
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        var events = response;
                        console.log(events)
                        successCallback(events);
                    },
                    error: function(error) {
                        console.log('Error fetching events:', error);
                    }
                });
            },
            eventClick: function(info) {
                // fullcalendar 主要傳送 start、end、title，若有其他資料傳送，這裡要用 .extendedProps 抓額外資料
                var title = info.event.title
                var date = moment(info.event.start).format('YYYY-MM-DD')
                var location = info.event.extendedProps.location
                console.log(location)
                document.getElementById('calendar-title').innerHTML = "專案名稱: " +title;
                document.getElementById('calendar-date').innerHTML = "日期: " + date;
                document.getElementById('calendar-location').innerHTML = "地點: " + location;
            },
        });
        calendar.render();
    });

  </script>
{% endblock %}